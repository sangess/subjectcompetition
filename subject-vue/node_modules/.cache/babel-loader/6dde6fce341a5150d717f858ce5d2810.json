{"remainingRequest":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\babel-loader\\lib\\index.js!D:\\IDEA_workspace2\\subject-vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\IDEA_workspace2\\subject-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IDEA_workspace2\\subject-vue\\src\\views\\student\\student_work.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\IDEA_workspace2\\subject-vue\\src\\views\\student\\student_work.vue","mtime":1622205705069},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport api from \"../../main\";\nexport default {\n  inject: ['reload'],\n  name: \"student_work\",\n  data: function data() {\n    return {\n      markWorks: [],\n      editId: \"\",\n      file: \"\",\n      dialogTableVisible: false,\n      api: api,\n      fileTip: \"附件\",\n      handOutWorks: [],\n      unHandOutWorks: [],\n      workOrUpload: \"upload\",\n      tabPosition: 'left',\n      unOrEd: 'Ed',\n      form: {\n        workName: \"\",\n        projectId: \"\"\n      },\n      fileList: [],\n      myProjects: [],\n      rules: {\n        workName: [{\n          required: true,\n          message: \"请填写作品名称\",\n          trigger: \"blur\"\n        }],\n        projectId: [{\n          required: true,\n          message: \"请选择提交的项目\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.showMyComps();\n    this.getHandOutWorks();\n    this.getUnHandOutWorks();\n    this.getWorksMark();\n  },\n  methods: {\n    /**\n     * 显示学生所有的项目\n     */\n    showMyComps: function showMyComps() {\n      var that = this;\n      var studentId = that.$store.state.id;\n      that.$axios.get(api + \"/project/getStudentProjects/\" + studentId).then(function (response) {\n        that.myProjects = response.data;\n      });\n    },\n    submitUpload: function submitUpload(form) {\n      var that = this;\n      var dataForm = new FormData();\n      that.$refs[form].validate(function (valid) {\n        if (valid) {\n          dataForm.append(\"workName\", that.form.workName);\n          dataForm.append(\"projectId\", that.form.projectId);\n\n          for (var i = 0; i < that.fileList.length; i++) {\n            dataForm.append(\"uploadFile\", that.fileList[i].raw);\n          }\n\n          that.$axios({\n            url: api + \"/student/workUpload\",\n            method: \"post\",\n            data: dataForm,\n            headers: {\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          }).then(function (response) {\n            that.$message({\n              type: response.data.code == 200 ? 'success' : 'error',\n              message: response.data.message\n            });\n            that.reload();\n            that.workOrUpload = \"work\";\n          });\n        } else {\n          that.$message.error(\"请正确填写作品信息！\");\n          return false;\n        }\n      });\n    },\n    uploadChange: function uploadChange(file, filelist) {\n      this.fileList = filelist;\n    },\n    editChange: function editChange(file, filelist) {\n      var that = this;\n      that.file = filelist;\n    },\n    // 文件移除时的钩子\n    handleRemove: function handleRemove(file, fileList) {\n      this.filelist = fileList;\n    },\n\n    /**\n     * 得到交过作品的列表\n     */\n    getHandOutWorks: function getHandOutWorks() {\n      var that = this;\n      that.$axios.get(api + '/student/getHandOutWorks/' + that.$store.state.id).then(function (response) {\n        that.handOutWorks = response.data;\n      });\n    },\n\n    /**\n     * 得到待提交作品的列表\n     */\n    getUnHandOutWorks: function getUnHandOutWorks() {\n      var that = this;\n      that.$axios.get(api + '/student/getUnHandOutWorks/' + that.$store.state.id).then(function (response) {\n        that.unHandOutWorks = response.data;\n        console.log(that.unHandOutWorks);\n      });\n    },\n    editWorkFile: function editWorkFile(workFileId) {\n      var that = this;\n      console.log(that.file[0].raw);\n      console.log(that.editId);\n      var data = new FormData();\n      data.append(\"workFileId\", that.editId);\n      data.append(\"workFile\", that.file[0].raw);\n      that.$axios({\n        url: api + \"/student/editWork\",\n        method: \"post\",\n        data: data,\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      }).then(function (response) {\n        that.$message({\n          type: response.data.code == 200 ? 'success' : 'error',\n          message: response.data.message\n        });\n        that.reload();\n        that.workOrUpload = \"work\";\n      });\n    },\n    deleteWorkFile: function deleteWorkFile(workFileId) {\n      var that = this;\n      that.$axios.get(api + \"/student/deleteWorkFile/\" + workFileId).then(function (response) {\n        that.$message({\n          type: response.data.code == 200 ? 'success' : 'error',\n          message: response.data.message\n        });\n        that.reload();\n        that.workOrUpload = \"work\";\n      });\n    },\n    getWorksMark: function getWorksMark() {\n      var that = this;\n      that.$axios.get(api + '/student/getWorksMark/' + that.$store.state.id).then(function (response) {\n        that.markWorks = response.data;\n      });\n    }\n  },\n  filters: {\n    dataTime: function dataTime(value) {\n      if (value == undefined) return '-';\n      value = new Date(value);\n\n      if (value instanceof Date) {\n        var d = value;\n        var year = d.getFullYear();\n        var m = d.getMonth() + 1;\n        var day = d.getDate() < 10 ? '0' + d.getDate() : d.getDate();\n        var myDate = year + '年' + m + '月 ' + day + '日';\n        return myDate;\n      } else {\n        return \"-\";\n      }\n    }\n  }\n};",{"version":3,"sources":["student_work.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <el-card>\r\n    <el-tabs  v-model=\"workOrUpload\">\r\n      <el-tab-pane label=\"作品提交\" name=\"upload\">\r\n        <el-form ref=\"form\" style=\"width: 520px\"  :model=\"form\" label-width=\"120px\" :rules=\"rules\">\r\n      <el-form-item  label=\"作品名\" prop=\"workName\">\r\n        <el-input v-model=\"form.workName\" name=\"workName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item  label=\"上交的项目\" prop=\"projectId\">\r\n        <el-select v-model=\"form.projectId\" name=\"projectId\" placeholder=\"请选择需要上交的项目\">\r\n          <el-option v-for=\"project in myProjects\"\r\n                      :key=\"project.id\"\r\n                      :label=\"project.projectName\"\r\n                      :value=\"project.id\"\r\n                      :disabled=\"project.comp.compState>2\">\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"上传文件\">\r\n        <el-upload\r\n                name=\"files\"\r\n                ref=\"upload\"\r\n                action=\"/url\"\r\n                :limit=\"5\"\r\n                multiple\r\n                :file-list=\"fileList\"\r\n                :with-credentials=\"true\"\r\n                :on-change=\"uploadChange\"\r\n                :on-remove=\"handleRemove\"\r\n                :auto-upload=\"false\">\r\n          <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n          <div slot=\"tip\" class=\"el-upload__tip\">最多上传5个文件，单个文件大小不得超过100MB,一共大小不得超过200MB</div>\r\n        </el-upload>\r\n        <!--\r\n                :data=\"formData\"\r\n                :on-success=\"upFile\"\r\n                :on-remove=\"handleRemove\"\r\n                :on-exceed=\"handleExceed\"-->\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"submitUpload('form')\">确认上交</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"作品管理\" name=\"work\">\r\n        <el-tabs  v-model=\"unOrEd\" :tab-position=\"tabPosition\">\r\n          <el-tab-pane label=\"已提交\" name=\"Ed\">\r\n            <el-table :data=\"handOutWorks\" style=\"width: 100%\">\r\n              <el-table-column type=\"expand\">\r\n                <template slot-scope=\"props\">\r\n                  <el-form label-position=\"right\" style=\"background-color: rgba(146,255,152,0.58);border-radius: 20px\" >\r\n                    <el-form-item inline  v-for=\"(workFile,index) in props.row.workFiles\" :key =\"workFile.id\" >\r\n                      <el-row :gutter=\"40\">\r\n                        <el-col :span=\"2\"> <span style=\"color: #1402bf;float: right\">{{ fileTip+String((index+1))}}</span></el-col>\r\n                        <el-col :span=\"10\"> <span>{{ workFile.fileName}}</span></el-col>\r\n                        <el-col :span=\"3\"><a :href='api+\"/file/downloadFile/\"+workFile.id'><el-link icon=\"el-icon-download\" :underline=\"false\">下载附件</el-link></a></el-col>\r\n                        <el-col :span=\"3\"><el-link icon=\"el-icon-edit\" @click=\"editId=workFile.id,dialogTableVisible=true\" :underline=\"false\">修改</el-link></el-col>\r\n                        <el-col :span=\"3\">\r\n                          <el-popconfirm title=\"删除该文件？操作不可逆！\" @confirm=\"deleteWorkFile(workFile.id)\">\r\n                            <el-link icon=\"el-icon-delete\"  slot=\"reference\" :underline=\"false\">删除</el-link>\r\n                          </el-popconfirm>\r\n                        </el-col>\r\n                      </el-row>\r\n                    </el-form-item>\r\n                  </el-form>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"竞赛 ID\" prop=\"project.comp.id\"></el-table-column>\r\n              <el-table-column label=\"竞赛名\" prop=\"project.comp.compName\"></el-table-column>\r\n              <el-table-column label=\"项目名\" prop=\"project.projectName\"></el-table-column>\r\n              <el-table-column label=\"作品名\" prop=\"workName\"></el-table-column>\r\n              <el-table-column label=\"作品得分\" prop=\"score\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.score}}{{scope.row.ifMark==false?'(未打分)':''}}\r\n                </template>\r\n              </el-table-column>\r\n        </el-table>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"待提交\" name=\"un\">\r\n            <el-table :data=\"unHandOutWorks\" style=\"width: 100%\">\r\n              <el-table-column label=\"竞赛 ID\" prop=\"comp.id\"></el-table-column>\r\n              <el-table-column label=\"竞赛名\" prop=\"comp.compName\"></el-table-column>\r\n              <el-table-column label=\"项目名\" prop=\"projectName\"></el-table-column>\r\n              <el-table-column label=\"截至报名日期\" prop=\"comp.notApplyTime\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.comp.notApplyTime|dataTime}}\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"比赛时间\" prop=\"comp.occurrenceTime\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.comp.occurrenceTime|dataTime}}\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"状态\" prop=\"projectName\">\r\n                <el-button type=\"warning\" plain size=\"mini\" @click=\"workOrUpload='upload'\">尚未提交作品</el-button>\r\n              </el-table-column>\r\n            </el-table>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"已评分\" name=\"mark\">\r\n            <el-table :data=\"markWorks\" style=\"width: 100%\">\r\n              <el-table-column label=\"竞赛 ID\" prop=\"project.comp.id\"></el-table-column>\r\n              <el-table-column label=\"竞赛名\" prop=\"project.comp.compName\"></el-table-column>\r\n              <el-table-column label=\"项目名\" prop=\"project.projectName\"></el-table-column>\r\n              <el-table-column label=\"作品名\" prop=\"workName\"></el-table-column>\r\n              <el-table-column label=\"作品得分\" prop=\"score\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.score}}{{scope.row.score==0?'(未打分)':''}}\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n    <el-dialog  title=\"修改文件\" :visible.sync=\"dialogTableVisible\">\r\n      <el-upload\r\n              name=\"edit\"\r\n              action=\"/url\"\r\n              :limit=\"1\"\r\n              :file=\"file\"\r\n              :with-credentials=\"true\"\r\n              :on-change=\"editChange\"\r\n              :on-remove=\"handleRemove\"\r\n              :auto-upload=\"false\">\r\n        <el-button size=\"small\" type=\"primary\">选择文件</el-button>\r\n      </el-upload>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogTableVisible=false\">取消修改</el-button>\r\n        <el-button type=\"primary\" @click=\"editWorkFile()\">确认修改</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </el-card>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\n  import api from \"../../main\";\r\n  export default {\r\n    inject:['reload'],\r\n    name: \"student_work\",\r\n    data() {\r\n      return {\r\n        markWorks:[],\r\n        editId:\"\",\r\n        file:\"\",\r\n        dialogTableVisible:false,\r\n        api:api,\r\n        fileTip:\"附件\",\r\n        handOutWorks:[],\r\n        unHandOutWorks:[],\r\n        workOrUpload:\"upload\",\r\n        tabPosition:'left',\r\n        unOrEd:'Ed',\r\n        form:{\r\n          workName:\"\",\r\n          projectId:\"\",\r\n        },\r\n        fileList:[],\r\n        myProjects:[],\r\n        rules:{\r\n          workName:[\r\n              { required: true, message: \"请填写作品名称\", trigger: \"blur\" }\r\n          ],\r\n          projectId:[\r\n            { required: true, message: \"请选择提交的项目\", trigger: \"blur\" }\r\n          ]\r\n        },\r\n      }\r\n    },\r\n    mounted(){\r\n      this.showMyComps();\r\n      this.getHandOutWorks();\r\n      this.getUnHandOutWorks();\r\n      this.getWorksMark();\r\n    },\r\n    methods:{\r\n      /**\r\n       * 显示学生所有的项目\r\n       */\r\n      showMyComps(){\r\n        let that=this;\r\n        let studentId=that.$store.state.id;\r\n        that.$axios\r\n        .get(api+`/project/getStudentProjects/`+studentId)\r\n        .then(function (response) {\r\n          that.myProjects=response.data;\r\n        })\r\n      },\r\n      submitUpload(form){\r\n        let that =this;\r\n        let dataForm=new FormData();\r\n        that.$refs[form].validate(valid=>{\r\n          if(valid){\r\n            dataForm.append(\"workName\",that.form.workName);\r\n            dataForm.append(\"projectId\",that.form.projectId);\r\n            for(let i=0;i<that.fileList.length;i++){\r\n              dataForm.append(\"uploadFile\",that.fileList[i].raw);\r\n            }\r\n            that.$axios({\r\n              url:api+`/student/workUpload`,\r\n              method:\"post\",\r\n              data:dataForm,\r\n              headers: {\r\n                \"Content-Type\":\"multipart/form-data\"\r\n              }\r\n            })\r\n            .then(function (response) {\r\n              that.$message({\r\n                type:response.data.code==200?'success':'error',\r\n                message:response.data.message\r\n              });\r\n              that.reload();\r\n              that.workOrUpload=\"work\";\r\n            })\r\n          }else{\r\n            that.$message.error(\"请正确填写作品信息！\");\r\n            return false;\r\n          }\r\n        })\r\n      },\r\n      uploadChange(file, filelist){\r\n        this.fileList=filelist;\r\n      },\r\n      editChange(file, filelist){\r\n        let that=this;\r\n        that.file=filelist;\r\n      },\r\n      // 文件移除时的钩子\r\n      handleRemove(file, fileList) {\r\n        this.filelist = fileList\r\n      },\r\n      /**\r\n       * 得到交过作品的列表\r\n       */\r\n      getHandOutWorks(){\r\n        let that =this;\r\n        that.$axios\r\n          .get(api+'/student/getHandOutWorks/'+that.$store.state.id)\r\n          .then(function (response) {\r\n            that.handOutWorks=response.data;\r\n          })\r\n      },\r\n      /**\r\n       * 得到待提交作品的列表\r\n       */\r\n      getUnHandOutWorks(){\r\n        let that =this;\r\n        that.$axios\r\n        .get(api+'/student/getUnHandOutWorks/'+that.$store.state.id)\r\n        .then(function (response) {\r\n          that.unHandOutWorks=response.data;\r\n          console.log(that.unHandOutWorks);\r\n        })\r\n      },\r\n      editWorkFile(workFileId){\r\n        let that =this;\r\n        console.log(that.file[0].raw);\r\n        console.log(that.editId);\r\n        let data=new FormData();\r\n        data.append(\"workFileId\",that.editId);\r\n        data.append(\"workFile\",that.file[0].raw);\r\n        that.$axios({\r\n          url:api+`/student/editWork`,\r\n          method:\"post\",\r\n          data:data,\r\n          headers: {\r\n            \"Content-Type\":\"multipart/form-data\"\r\n          }\r\n        })\r\n          .then(function (response) {\r\n            that.$message({\r\n              type:response.data.code==200?'success':'error',\r\n              message:response.data.message\r\n            });\r\n            that.reload();\r\n            that.workOrUpload=\"work\";\r\n          })\r\n      },\r\n      deleteWorkFile(workFileId){\r\n        let that=this;\r\n        that.$axios\r\n          .get(api+\"/student/deleteWorkFile/\"+workFileId)\r\n          .then(function (response) {\r\n            that.$message({\r\n              type:response.data.code==200?'success':'error',\r\n              message:response.data.message\r\n            });\r\n            that.reload();\r\n            that.workOrUpload=\"work\";\r\n          })\r\n      },\r\n      getWorksMark(){\r\n        let that =this;\r\n        that.$axios\r\n        .get(api+'/student/getWorksMark/'+that.$store.state.id)\r\n        .then(function (response) {\r\n          that.markWorks=response.data;\r\n        })\r\n      }\r\n    },\r\n    filters:{\r\n      dataTime: function(value) {\r\n        if (value==undefined)\r\n          return '-';\r\n        value = new Date(value)\r\n        if (value instanceof Date) {\r\n          var d = value;\r\n          var year=d.getFullYear();\r\n          var m = d.getMonth() + 1;\r\n          var day = d.getDate() < 10 ? '0' + d.getDate() : d.getDate();\r\n          var myDate = year + '年'+m + '月 ' + day +'日';\r\n          return myDate;\r\n        } else {\r\n          return \"-\";\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n</style>"],"sourceRoot":"src/views/student"}]}