{"remainingRequest":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IDEA_workspace2\\subject-vue\\src\\views\\student\\student_work.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\IDEA_workspace2\\subject-vue\\src\\views\\student\\student_work.vue","mtime":1622205705069},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IDEA_workspace2\\subject-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport api from \"../../main\";\nexport default {\n  inject:['reload'],\n  name: \"student_work\",\n  data() {\n    return {\n      markWorks:[],\n      editId:\"\",\n      file:\"\",\n      dialogTableVisible:false,\n      api:api,\n      fileTip:\"附件\",\n      handOutWorks:[],\n      unHandOutWorks:[],\n      workOrUpload:\"upload\",\n      tabPosition:'left',\n      unOrEd:'Ed',\n      form:{\n        workName:\"\",\n        projectId:\"\",\n      },\n      fileList:[],\n      myProjects:[],\n      rules:{\n        workName:[\n            { required: true, message: \"请填写作品名称\", trigger: \"blur\" }\n        ],\n        projectId:[\n          { required: true, message: \"请选择提交的项目\", trigger: \"blur\" }\n        ]\n      },\n    }\n  },\n  mounted(){\n    this.showMyComps();\n    this.getHandOutWorks();\n    this.getUnHandOutWorks();\n    this.getWorksMark();\n  },\n  methods:{\n    /**\n     * 显示学生所有的项目\n     */\n    showMyComps(){\n      let that=this;\n      let studentId=that.$store.state.id;\n      that.$axios\n      .get(api+`/project/getStudentProjects/`+studentId)\n      .then(function (response) {\n        that.myProjects=response.data;\n      })\n    },\n    submitUpload(form){\n      let that =this;\n      let dataForm=new FormData();\n      that.$refs[form].validate(valid=>{\n        if(valid){\n          dataForm.append(\"workName\",that.form.workName);\n          dataForm.append(\"projectId\",that.form.projectId);\n          for(let i=0;i<that.fileList.length;i++){\n            dataForm.append(\"uploadFile\",that.fileList[i].raw);\n          }\n          that.$axios({\n            url:api+`/student/workUpload`,\n            method:\"post\",\n            data:dataForm,\n            headers: {\n              \"Content-Type\":\"multipart/form-data\"\n            }\n          })\n          .then(function (response) {\n            that.$message({\n              type:response.data.code==200?'success':'error',\n              message:response.data.message\n            });\n            that.reload();\n            that.workOrUpload=\"work\";\n          })\n        }else{\n          that.$message.error(\"请正确填写作品信息！\");\n          return false;\n        }\n      })\n    },\n    uploadChange(file, filelist){\n      this.fileList=filelist;\n    },\n    editChange(file, filelist){\n      let that=this;\n      that.file=filelist;\n    },\n    // 文件移除时的钩子\n    handleRemove(file, fileList) {\n      this.filelist = fileList\n    },\n    /**\n     * 得到交过作品的列表\n     */\n    getHandOutWorks(){\n      let that =this;\n      that.$axios\n        .get(api+'/student/getHandOutWorks/'+that.$store.state.id)\n        .then(function (response) {\n          that.handOutWorks=response.data;\n        })\n    },\n    /**\n     * 得到待提交作品的列表\n     */\n    getUnHandOutWorks(){\n      let that =this;\n      that.$axios\n      .get(api+'/student/getUnHandOutWorks/'+that.$store.state.id)\n      .then(function (response) {\n        that.unHandOutWorks=response.data;\n        console.log(that.unHandOutWorks);\n      })\n    },\n    editWorkFile(workFileId){\n      let that =this;\n      console.log(that.file[0].raw);\n      console.log(that.editId);\n      let data=new FormData();\n      data.append(\"workFileId\",that.editId);\n      data.append(\"workFile\",that.file[0].raw);\n      that.$axios({\n        url:api+`/student/editWork`,\n        method:\"post\",\n        data:data,\n        headers: {\n          \"Content-Type\":\"multipart/form-data\"\n        }\n      })\n        .then(function (response) {\n          that.$message({\n            type:response.data.code==200?'success':'error',\n            message:response.data.message\n          });\n          that.reload();\n          that.workOrUpload=\"work\";\n        })\n    },\n    deleteWorkFile(workFileId){\n      let that=this;\n      that.$axios\n        .get(api+\"/student/deleteWorkFile/\"+workFileId)\n        .then(function (response) {\n          that.$message({\n            type:response.data.code==200?'success':'error',\n            message:response.data.message\n          });\n          that.reload();\n          that.workOrUpload=\"work\";\n        })\n    },\n    getWorksMark(){\n      let that =this;\n      that.$axios\n      .get(api+'/student/getWorksMark/'+that.$store.state.id)\n      .then(function (response) {\n        that.markWorks=response.data;\n      })\n    }\n  },\n  filters:{\n    dataTime: function(value) {\n      if (value==undefined)\n        return '-';\n      value = new Date(value)\n      if (value instanceof Date) {\n        var d = value;\n        var year=d.getFullYear();\n        var m = d.getMonth() + 1;\n        var day = d.getDate() < 10 ? '0' + d.getDate() : d.getDate();\n        var myDate = year + '年'+m + '月 ' + day +'日';\n        return myDate;\n      } else {\n        return \"-\";\n      }\n    }\n  }\n}\n",{"version":3,"sources":["student_work.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"student_work.vue","sourceRoot":"src/views/student","sourcesContent":["<template>\r\n  <el-card>\r\n    <el-tabs  v-model=\"workOrUpload\">\r\n      <el-tab-pane label=\"作品提交\" name=\"upload\">\r\n        <el-form ref=\"form\" style=\"width: 520px\"  :model=\"form\" label-width=\"120px\" :rules=\"rules\">\r\n      <el-form-item  label=\"作品名\" prop=\"workName\">\r\n        <el-input v-model=\"form.workName\" name=\"workName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item  label=\"上交的项目\" prop=\"projectId\">\r\n        <el-select v-model=\"form.projectId\" name=\"projectId\" placeholder=\"请选择需要上交的项目\">\r\n          <el-option v-for=\"project in myProjects\"\r\n                      :key=\"project.id\"\r\n                      :label=\"project.projectName\"\r\n                      :value=\"project.id\"\r\n                      :disabled=\"project.comp.compState>2\">\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"上传文件\">\r\n        <el-upload\r\n                name=\"files\"\r\n                ref=\"upload\"\r\n                action=\"/url\"\r\n                :limit=\"5\"\r\n                multiple\r\n                :file-list=\"fileList\"\r\n                :with-credentials=\"true\"\r\n                :on-change=\"uploadChange\"\r\n                :on-remove=\"handleRemove\"\r\n                :auto-upload=\"false\">\r\n          <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n          <div slot=\"tip\" class=\"el-upload__tip\">最多上传5个文件，单个文件大小不得超过100MB,一共大小不得超过200MB</div>\r\n        </el-upload>\r\n        <!--\r\n                :data=\"formData\"\r\n                :on-success=\"upFile\"\r\n                :on-remove=\"handleRemove\"\r\n                :on-exceed=\"handleExceed\"-->\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"submitUpload('form')\">确认上交</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"作品管理\" name=\"work\">\r\n        <el-tabs  v-model=\"unOrEd\" :tab-position=\"tabPosition\">\r\n          <el-tab-pane label=\"已提交\" name=\"Ed\">\r\n            <el-table :data=\"handOutWorks\" style=\"width: 100%\">\r\n              <el-table-column type=\"expand\">\r\n                <template slot-scope=\"props\">\r\n                  <el-form label-position=\"right\" style=\"background-color: rgba(146,255,152,0.58);border-radius: 20px\" >\r\n                    <el-form-item inline  v-for=\"(workFile,index) in props.row.workFiles\" :key =\"workFile.id\" >\r\n                      <el-row :gutter=\"40\">\r\n                        <el-col :span=\"2\"> <span style=\"color: #1402bf;float: right\">{{ fileTip+String((index+1))}}</span></el-col>\r\n                        <el-col :span=\"10\"> <span>{{ workFile.fileName}}</span></el-col>\r\n                        <el-col :span=\"3\"><a :href='api+\"/file/downloadFile/\"+workFile.id'><el-link icon=\"el-icon-download\" :underline=\"false\">下载附件</el-link></a></el-col>\r\n                        <el-col :span=\"3\"><el-link icon=\"el-icon-edit\" @click=\"editId=workFile.id,dialogTableVisible=true\" :underline=\"false\">修改</el-link></el-col>\r\n                        <el-col :span=\"3\">\r\n                          <el-popconfirm title=\"删除该文件？操作不可逆！\" @confirm=\"deleteWorkFile(workFile.id)\">\r\n                            <el-link icon=\"el-icon-delete\"  slot=\"reference\" :underline=\"false\">删除</el-link>\r\n                          </el-popconfirm>\r\n                        </el-col>\r\n                      </el-row>\r\n                    </el-form-item>\r\n                  </el-form>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"竞赛 ID\" prop=\"project.comp.id\"></el-table-column>\r\n              <el-table-column label=\"竞赛名\" prop=\"project.comp.compName\"></el-table-column>\r\n              <el-table-column label=\"项目名\" prop=\"project.projectName\"></el-table-column>\r\n              <el-table-column label=\"作品名\" prop=\"workName\"></el-table-column>\r\n              <el-table-column label=\"作品得分\" prop=\"score\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.score}}{{scope.row.ifMark==false?'(未打分)':''}}\r\n                </template>\r\n              </el-table-column>\r\n        </el-table>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"待提交\" name=\"un\">\r\n            <el-table :data=\"unHandOutWorks\" style=\"width: 100%\">\r\n              <el-table-column label=\"竞赛 ID\" prop=\"comp.id\"></el-table-column>\r\n              <el-table-column label=\"竞赛名\" prop=\"comp.compName\"></el-table-column>\r\n              <el-table-column label=\"项目名\" prop=\"projectName\"></el-table-column>\r\n              <el-table-column label=\"截至报名日期\" prop=\"comp.notApplyTime\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.comp.notApplyTime|dataTime}}\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"比赛时间\" prop=\"comp.occurrenceTime\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.comp.occurrenceTime|dataTime}}\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column label=\"状态\" prop=\"projectName\">\r\n                <el-button type=\"warning\" plain size=\"mini\" @click=\"workOrUpload='upload'\">尚未提交作品</el-button>\r\n              </el-table-column>\r\n            </el-table>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"已评分\" name=\"mark\">\r\n            <el-table :data=\"markWorks\" style=\"width: 100%\">\r\n              <el-table-column label=\"竞赛 ID\" prop=\"project.comp.id\"></el-table-column>\r\n              <el-table-column label=\"竞赛名\" prop=\"project.comp.compName\"></el-table-column>\r\n              <el-table-column label=\"项目名\" prop=\"project.projectName\"></el-table-column>\r\n              <el-table-column label=\"作品名\" prop=\"workName\"></el-table-column>\r\n              <el-table-column label=\"作品得分\" prop=\"score\">\r\n                <template slot-scope=\"scope\">\r\n                  {{scope.row.score}}{{scope.row.score==0?'(未打分)':''}}\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n    <el-dialog  title=\"修改文件\" :visible.sync=\"dialogTableVisible\">\r\n      <el-upload\r\n              name=\"edit\"\r\n              action=\"/url\"\r\n              :limit=\"1\"\r\n              :file=\"file\"\r\n              :with-credentials=\"true\"\r\n              :on-change=\"editChange\"\r\n              :on-remove=\"handleRemove\"\r\n              :auto-upload=\"false\">\r\n        <el-button size=\"small\" type=\"primary\">选择文件</el-button>\r\n      </el-upload>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogTableVisible=false\">取消修改</el-button>\r\n        <el-button type=\"primary\" @click=\"editWorkFile()\">确认修改</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </el-card>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\n  import api from \"../../main\";\r\n  export default {\r\n    inject:['reload'],\r\n    name: \"student_work\",\r\n    data() {\r\n      return {\r\n        markWorks:[],\r\n        editId:\"\",\r\n        file:\"\",\r\n        dialogTableVisible:false,\r\n        api:api,\r\n        fileTip:\"附件\",\r\n        handOutWorks:[],\r\n        unHandOutWorks:[],\r\n        workOrUpload:\"upload\",\r\n        tabPosition:'left',\r\n        unOrEd:'Ed',\r\n        form:{\r\n          workName:\"\",\r\n          projectId:\"\",\r\n        },\r\n        fileList:[],\r\n        myProjects:[],\r\n        rules:{\r\n          workName:[\r\n              { required: true, message: \"请填写作品名称\", trigger: \"blur\" }\r\n          ],\r\n          projectId:[\r\n            { required: true, message: \"请选择提交的项目\", trigger: \"blur\" }\r\n          ]\r\n        },\r\n      }\r\n    },\r\n    mounted(){\r\n      this.showMyComps();\r\n      this.getHandOutWorks();\r\n      this.getUnHandOutWorks();\r\n      this.getWorksMark();\r\n    },\r\n    methods:{\r\n      /**\r\n       * 显示学生所有的项目\r\n       */\r\n      showMyComps(){\r\n        let that=this;\r\n        let studentId=that.$store.state.id;\r\n        that.$axios\r\n        .get(api+`/project/getStudentProjects/`+studentId)\r\n        .then(function (response) {\r\n          that.myProjects=response.data;\r\n        })\r\n      },\r\n      submitUpload(form){\r\n        let that =this;\r\n        let dataForm=new FormData();\r\n        that.$refs[form].validate(valid=>{\r\n          if(valid){\r\n            dataForm.append(\"workName\",that.form.workName);\r\n            dataForm.append(\"projectId\",that.form.projectId);\r\n            for(let i=0;i<that.fileList.length;i++){\r\n              dataForm.append(\"uploadFile\",that.fileList[i].raw);\r\n            }\r\n            that.$axios({\r\n              url:api+`/student/workUpload`,\r\n              method:\"post\",\r\n              data:dataForm,\r\n              headers: {\r\n                \"Content-Type\":\"multipart/form-data\"\r\n              }\r\n            })\r\n            .then(function (response) {\r\n              that.$message({\r\n                type:response.data.code==200?'success':'error',\r\n                message:response.data.message\r\n              });\r\n              that.reload();\r\n              that.workOrUpload=\"work\";\r\n            })\r\n          }else{\r\n            that.$message.error(\"请正确填写作品信息！\");\r\n            return false;\r\n          }\r\n        })\r\n      },\r\n      uploadChange(file, filelist){\r\n        this.fileList=filelist;\r\n      },\r\n      editChange(file, filelist){\r\n        let that=this;\r\n        that.file=filelist;\r\n      },\r\n      // 文件移除时的钩子\r\n      handleRemove(file, fileList) {\r\n        this.filelist = fileList\r\n      },\r\n      /**\r\n       * 得到交过作品的列表\r\n       */\r\n      getHandOutWorks(){\r\n        let that =this;\r\n        that.$axios\r\n          .get(api+'/student/getHandOutWorks/'+that.$store.state.id)\r\n          .then(function (response) {\r\n            that.handOutWorks=response.data;\r\n          })\r\n      },\r\n      /**\r\n       * 得到待提交作品的列表\r\n       */\r\n      getUnHandOutWorks(){\r\n        let that =this;\r\n        that.$axios\r\n        .get(api+'/student/getUnHandOutWorks/'+that.$store.state.id)\r\n        .then(function (response) {\r\n          that.unHandOutWorks=response.data;\r\n          console.log(that.unHandOutWorks);\r\n        })\r\n      },\r\n      editWorkFile(workFileId){\r\n        let that =this;\r\n        console.log(that.file[0].raw);\r\n        console.log(that.editId);\r\n        let data=new FormData();\r\n        data.append(\"workFileId\",that.editId);\r\n        data.append(\"workFile\",that.file[0].raw);\r\n        that.$axios({\r\n          url:api+`/student/editWork`,\r\n          method:\"post\",\r\n          data:data,\r\n          headers: {\r\n            \"Content-Type\":\"multipart/form-data\"\r\n          }\r\n        })\r\n          .then(function (response) {\r\n            that.$message({\r\n              type:response.data.code==200?'success':'error',\r\n              message:response.data.message\r\n            });\r\n            that.reload();\r\n            that.workOrUpload=\"work\";\r\n          })\r\n      },\r\n      deleteWorkFile(workFileId){\r\n        let that=this;\r\n        that.$axios\r\n          .get(api+\"/student/deleteWorkFile/\"+workFileId)\r\n          .then(function (response) {\r\n            that.$message({\r\n              type:response.data.code==200?'success':'error',\r\n              message:response.data.message\r\n            });\r\n            that.reload();\r\n            that.workOrUpload=\"work\";\r\n          })\r\n      },\r\n      getWorksMark(){\r\n        let that =this;\r\n        that.$axios\r\n        .get(api+'/student/getWorksMark/'+that.$store.state.id)\r\n        .then(function (response) {\r\n          that.markWorks=response.data;\r\n        })\r\n      }\r\n    },\r\n    filters:{\r\n      dataTime: function(value) {\r\n        if (value==undefined)\r\n          return '-';\r\n        value = new Date(value)\r\n        if (value instanceof Date) {\r\n          var d = value;\r\n          var year=d.getFullYear();\r\n          var m = d.getMonth() + 1;\r\n          var day = d.getDate() < 10 ? '0' + d.getDate() : d.getDate();\r\n          var myDate = year + '年'+m + '月 ' + day +'日';\r\n          return myDate;\r\n        } else {\r\n          return \"-\";\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n</style>"]}]}